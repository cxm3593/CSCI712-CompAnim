import{V as a,W as L,S as A,P as C,O as M,C as z,e as T,o as D,p as W,g as k,c as g,Q as v}from"./OrbitControls-4ff66f46.js";let l,F=new a(0,-9.81,0);const V=10,h=new L;h.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(h.domElement);window.addEventListener("resize",function(){p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)});const f=new A,E=new k;let _=0;const p=new C(90,window.innerWidth/window.innerHeight,.1,1e3);p.position.set(0,0,-60);const P=new M(p,h.domElement);P.minDistance=60;P.maxDistance=100;class H{constructor(e){this.name=e.emitter_name,this.location=e.location,this.speed=e.speed,this.spawn_rate=e.spawn_rate,this.initial_direction=e.initial_direction,this.direction_offset_range=e.direction_offset_range,this.life_time=e.life_time,this.color=e.color,this.mass=e.mass,this.particle_list=[],this.accumulatedTime=0}emit(e){this.accumulatedTime+=e;const t=1/this.spawn_rate;var n=Math.floor(this.accumulatedTime/t);for(let o=0;o<n;o++){const c=new a(2*(Math.random()-.5)*this.direction_offset_range.x,2*(Math.random()-.5)*this.direction_offset_range.y,2*(Math.random()-.5)*this.direction_offset_range.z),r=this.initial_direction.clone().add(c).multiplyScalar(this.speed),s=new R(this.location,this.color,this.life_time,r);this.particle_list.push(s),f.add(s.point_object)}n>0&&(this.accumulatedTime-=n*t)}updateParticles(e){for(let n=0;n<this.particle_list.length;n++){var t=this.particle_list[n];t.update(e),t.isdead==!0&&(this.particle_list.splice(n,1),n--)}}}class R{constructor(e,t,n,o){this.location=e,this.color=t,this.life_time=n,this.velocity=o,this.life_elapsed=0,this.isdead=!1;const c=new T().setFromPoints([new a]),r=new D({color:t,size:1}),s=new W(c,r);s.position.copy(this.location),this.point_object=s}update(e){if(this.life_elapsed+=e,this.life_elapsed>=this.life_time){f.remove(this.point_object),this.isdead=!0;return}this.velocity.add(F.clone().multiplyScalar(e));const t=this.velocity.clone().multiplyScalar(e),n=this.point_object.position.clone().add(t);this.point_object.position.copy(n);const o=this.life_elapsed/this.life_time;this.point_object.material.opacity=1-o;const c=new z(this.color.r*(1-o),this.color.g*(1-o),this.color.b*(1-o));this.point_object.material.color.set(c)}die(){f.remove(this.point_object)}}l=new H({emitter_name:"emitter",location:new a(0,0,0),speed:5,spawn_rate:30,initial_direction:new a(1,0,0),direction_offset_range:new a(.5,.5,.5),life_time:3,color:new z(1,0,0),mass:1});function w(){const i=document.getElementById("v0_x").value,e=document.getElementById("v0_y").value,t=document.getElementById("v0_z").value,n=new a(i,e,t).normalize();l.initial_direction.copy(n)}document.getElementById("v0_x").addEventListener("input",w);document.getElementById("v0_y").addEventListener("input",w);document.getElementById("v0_z").addEventListener("input",w);w();function I(){const i=document.getElementById("speed").value;l.speed=i}document.getElementById("speed").addEventListener("input",I);I();function b(){const i=-parseFloat(document.getElementById("gravity").value);F.setY(i)}document.getElementById("gravity").addEventListener("input",b);b();let y,m;y=0;m=1;let x,d;async function G(){await fetch("./keyframe-input.txt").then(i=>i.text()).then(i=>{x=i.split(`
`),d=x.map(e=>{const[t,n,o,c,r,s,u,S]=e.split(" ");return{time:parseFloat(t),x:parseFloat(n),y:parseFloat(o),z:parseFloat(c),xa:parseFloat(r),ya:parseFloat(s),za:parseFloat(u),angle:parseFloat(S)}}),console.log("Loaded keyframe data")}).catch(i=>{console.error("Error fetching the file:",i)})}G();console.log(d);function B(i){i>=d[m].time&&m<d.length-1&&(y+=1,m+=1,B(i))}function O(i){const e=d[y],t=d[m],n=new a(e.x,e.y,e.z),o=new a(t.x,t.y,t.z);new v().setFromAxisAngle(new a(e.xa,e.ya,e.za),g.degToRad(e.angle)),new v().setFromAxisAngle(new a(t.xa,t.ya,t.za),g.degToRad(t.angle));const s=(i-e.time)/(t.time-e.time),u=new a;return u.lerpVectors(n,o,s),[u]}function j(){requestAnimationFrame(j);var i=E.getDelta();if(_=E.getElapsedTime(),_<V){B(_);const[e]=O(_);l.location.copy(e)}l.emit(i),l.updateParticles(i),h.render(f,p)}j();
