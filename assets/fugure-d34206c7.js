import{h as X,F as Z,i as $,V as y,Q as x,j as ee,k as te,l as ne,A as oe,d as ie,C as _,M as A,b as P,e as se,L as re,f as ae,S as ce,P as le,W as pe,O as de,a as he,c as ue,m as V,n as S,g as fe}from"./OrbitControls-322fbf48.js";class me extends X{constructor(e){super(e),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(e,o,d,c){const l=this,f=new Z(l.manager);f.setPath(l.path),f.setRequestHeader(l.requestHeader),f.setWithCredentials(l.withCredentials),f.load(e,function(s){try{o(l.parse(s))}catch(g){c?c(g):console.error(g),l.manager.itemError(e)}},d,c)}parse(e){function o(n){s(n)!=="HIERARCHY"&&console.error("THREE.BVHLoader: HIERARCHY expected.");const p=[],r=c(n,s(n),p);s(n)!=="MOTION"&&console.error("THREE.BVHLoader: MOTION expected.");let t=s(n).split(/[\s]+/);const i=parseInt(t[1]);isNaN(i)&&console.error("THREE.BVHLoader: Failed to read number of frames."),t=s(n).split(/[\s]+/);const m=parseFloat(t[2]);isNaN(m)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let h=0;h<i;h++)t=s(n).split(/[\s]+/),d(t,h*m,r);return p}function d(n,p,r){if(r.type==="ENDSITE")return;const t={time:p,position:new y,rotation:new x};r.frames.push(t);const i=new x,m=new y(1,0,0),h=new y(0,1,0),b=new y(0,0,1);for(let u=0;u<r.channels.length;u++)switch(r.channels[u]){case"Xposition":t.position.x=parseFloat(n.shift().trim());break;case"Yposition":t.position.y=parseFloat(n.shift().trim());break;case"Zposition":t.position.z=parseFloat(n.shift().trim());break;case"Xrotation":i.setFromAxisAngle(m,parseFloat(n.shift().trim())*Math.PI/180),t.rotation.multiply(i);break;case"Yrotation":i.setFromAxisAngle(h,parseFloat(n.shift().trim())*Math.PI/180),t.rotation.multiply(i);break;case"Zrotation":i.setFromAxisAngle(b,parseFloat(n.shift().trim())*Math.PI/180),t.rotation.multiply(i);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let u=0;u<r.children.length;u++)d(n,p,r.children[u])}function c(n,p,r){const t={name:"",type:"",frames:[]};r.push(t);let i=p.split(/[\s]+/);i[0].toUpperCase()==="END"&&i[1].toUpperCase()==="SITE"?(t.type="ENDSITE",t.name="ENDSITE"):(t.name=i[1],t.type=i[0].toUpperCase()),s(n)!=="{"&&console.error("THREE.BVHLoader: Expected opening { after type & name"),i=s(n).split(/[\s]+/),i[0]!=="OFFSET"&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+i[0]),i.length!==4&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const m=new y(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]));if((isNaN(m.x)||isNaN(m.y)||isNaN(m.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),t.offset=m,t.type!=="ENDSITE"){i=s(n).split(/[\s]+/),i[0]!=="CHANNELS"&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const h=parseInt(i[1]);t.channels=i.splice(2,h),t.children=[]}for(;;){const h=s(n);if(h==="}")return t;t.children.push(c(n,h,r))}}function l(n,p){const r=new ee;if(p.push(r),r.position.add(n.offset),r.name=n.name,n.type!=="ENDSITE")for(let t=0;t<n.children.length;t++)r.add(l(n.children[t],p));return r}function f(n){const p=[];for(let r=0;r<n.length;r++){const t=n[r];if(t.type==="ENDSITE")continue;const i=[],m=[],h=[];for(let b=0;b<t.frames.length;b++){const u=t.frames[b];i.push(u.time),m.push(u.position.x+t.offset.x),m.push(u.position.y+t.offset.y),m.push(u.position.z+t.offset.z),h.push(u.rotation.x),h.push(u.rotation.y),h.push(u.rotation.z),h.push(u.rotation.w)}g.animateBonePositions&&p.push(new te(t.name+".position",i,m)),g.animateBoneRotations&&p.push(new ne(t.name+".quaternion",i,h))}return new oe("animation",-1,p)}function s(n){let p;for(;(p=n.shift().trim()).length===0;);return p}const g=this,E=e.split(/[\r\n]+/g),H=o(E),T=[];l(H[0],T);const I=f(H);return{skeleton:new $(T),clip:I}}}class j{constructor(e,o=null){if(this.name=e.name,this.position=e.position,this.rotation=e.rotation,this.quaternion=e.quaternion,o!=null?this.parent=o:this.parent=null,this.children=new Array,e.children.length>0)for(let d of e.children){let c=new j(d,this);this.children.push(c)}}buildFigure(){const e=new ie(1,32,32),o=new _;o.setRGB(1,0,0);const d=new A({color:o}),c=new P(e,d);c.name=this.name,c.position.copy(this.position),c.quaternion.copy(this.quaternion),this.figureObject=c;for(let l of this.children){const f=l.buildFigure();this.figureObject.add(f),this.figureObject.updateMatrixWorld(!0);const s=new y,g=f.position.clone(),E=new se().setFromPoints([s,g]),H=new _;H.setRGB(0,1,0);const T=new re({color:H}),I=new ae(E,T);this.figureObject.add(I),l.parentLine=I}return c}registerName(e){if(e[this.name]=this,this.children.length>0)for(let o of this.children)o.registerName(e)}updateJoint(e){const o=e[this.name];if(o==null)return null;const d=o.position,c=o.quaternion;if(this.position.copy(d),this.quaternion.copy(c),this.updateJointFigure(),this.children.length>0)for(let l of this.children)l.updateJoint(e)}updateJointFigure(){if(this.figureObject.position.copy(this.position),this.figureObject.quaternion.copy(this.quaternion),this.parentLine!=null&&this.parent!=null){const e=new y(0,0,0),o=this.figureObject.position;this.parentLine.geometry.setFromPoints([e,o])}this.figureObject.updateMatrixWorld(!0)}}class D{constructor(e){this.tracks=e.tracks}getUpdate(e){const o={};for(let d of this.tracks){const l=d.name.split("."),f=l[0],s=l[1];let g;s=="position"?g=d.createInterpolant(new y):s=="quaternion"&&(g=d.createInterpolant(new x));const E=g.evaluate(e);o[f]==null&&(o[f]={}),s=="position"?o[f][s]=new y(E[0],E[1],E[2]):s=="quaternion"&&(o[f][s]=new x(E[0],E[1],E[2],E[3]))}return o}}class W{constructor(e){this.root=new j(e.bones[0]),this.registerNames()}generateFigure(){return this.figure=this.root.buildFigure(),this.figure}registerNames(){this.joint_table={},this.root.registerName(this.joint_table)}updateSkeleton(e){this.root.updateJoint(e)}}var v="./resources/wave.bvh";document.getElementById("bvh-selector").addEventListener("change",function(a){v=a.target.value});console.log(v);const M=new fe,F=new ce,B=new le(90,window.innerWidth/window.innerHeight,.1,1e3);B.position.set(0,200,300);const L=new pe;L.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(L.domElement);const z=new de(B,L.domElement);z.minDistance=300;z.maxDistance=700;window.addEventListener("resize",function(){B.aspect=window.innerWidth/window.innerHeight,B.updateProjectionMatrix(),L.setSize(window.innerWidth,window.innerHeight)});const we=new he(1e3,1e3),G=new _;G.setRGB(.3,.3,.3);const ge=new A({color:G}),q=new P(we,ge);q.rotation.x=ue.degToRad(-90);q.position.y=100;F.add(q);let k,N,O,C,w;const U=new me;U.load(v,function(a){const e=new V(a.skeleton.bones[0]);w=new S,w.add(a.skeleton.bones[0]),w.add(e),w.position.y=50,w.position.x=100,F.add(w),F.updateMatrixWorld(!0),N=new W(a.skeleton),O=new D(a.clip);const o=N.generateFigure();k=new S,k.add(o),k.position.y=100,F.add(k),C=a.clip.duration,K()});document.getElementById("bvh-selector").addEventListener("change",function(a){v=a.target.value,F.remove(k),U.load(v,function(e){N=new W(e.skeleton),O=new D(e.clip),C=e.clip.duration;const o=N.generateFigure();k=new S,k.add(o),k.position.y=100,F.add(k),F.remove(w),w=new S,w.add(e.skeleton.bones[0]);const d=new V(e.skeleton.bones[0]);w.add(d),w.position.y=50,w.position.x=100,F.add(w)})});let R=1;window.setRate=J;function J(){R=parseFloat(document.getElementById("playBackSet").value),isNaN(R)||(O.playbackRate=R)}document.getElementById("button").addEventListener("click",J);window.setPause=Y;function Y(){M.stop()}document.getElementById("pause_button").addEventListener("click",Y);window.setPlay=Q;function Q(){M.start()}document.getElementById("play_button").addEventListener("click",Q);function K(){requestAnimationFrame(K);var a=M.getElapsedTime();a=a*R;var e=0;a>C?e=a%C:e=a;const o=O.getUpdate(e);N.updateSkeleton(o),L.render(F,B)}
